# Session

## 개요
웹은 기본적으로 과거의 상태를 기억하지 않는 무상태(statteless) 연결이다.
무상태에서 과거를 기억하려면 여러 매커니즘이 필요하다.

## 세션 트랙킹
과거의 방문 기록을 추적하는 기법을 바로 session tracking이라 한다.
HTTP에서 세션 트랙킹은 쿠키를 사용한다.
쿠키는 문자열로 이루어진 이름과 값을 가지는 자료이다.

## 쿠키를 주고받는 시나리오

브라우저에서 최초로 서버를 호출하는 경우에 해당 서버에서 발행한 쿠키가 없다면 브라우저는 아무 것도 전송하지 않는다.
서버에서 응답 메시지를 보낼 때 브라우저에게 쿠키를 보내주는데 

서버에서는 응답메시지를 보낼 때 브라우저에게 쿠키를 보내주는데 이때 set-Cookie라는 HTTP 헤더를 이용한다.

브라우저는 쿠키를 받은 후 이에 대한 정보를 읽고 이를 파일형태로 저장할 건지 메모리상에서만 처리할 것인지를 결정한다. 이 판단은 유효기간을 보고 판단한다.

브라우저가 보관하는 쿠키는 다음에 다시 브라우저가 요청할 때 HTTP헤더에 Cookie라는 헤더 이름과 함께 전달한다. 쿠키에는 경로를 저장할 수 있어서 해당 경로에 맞는 쿠키가 전송된다.

## 쿠키
서버에서 쿠키를 발행하는 것은 서버에서 자동으로 발행되는 방식과 개발자가 코드를 통해 직접 발행하는 두 가지 방식이 존재한다.<br>
* 서버에서 자동으로 생성하는 쿠키 : 응답메시지를 작성할 때 정해진 쿠키가 없는 경우 자동으로 발행되며 was가 was마다 정해진 고유한 이름을 사용하여 쿠키를 생성한다. 톰캣의 경우 JSESSIONID라는 이름을 이용한다.
* 개발자가 생성하는 쿠키 : 이름을 원하는 대로 지정할 수 있고 유효기간등을 지정할 수 있다. 반드시 직접 응답에 추가해줘야한다.

## 세션 저장소
하나의 톰캣은 여러개의 웹 애플리케이션을 실행할 수 있다. 각 웹 애플리케이션은 고유한 메모리 영역을 생성하여 이 공간에서 서블릿이나 JSP등을 인스턴스로 만들어 서비스를 제공한다.
이 영역을 서블릿 컨텍스트라고 한다.<br>
톰캣이 발행하는 쿠키들을 관리하기 위한 메모리 영역이 하나 더 생성되는데 이 영역을 세션 저장소라고 한다.
세션 저장소는 기본적으로 키와 값을 보관한다. 이 때 키가 되는 것은 톰캣의 JSESSIONID이다.

## 세션을 이용한 상태유지
HttpServletRequest의 getSession()메소드를 실행하면 톰캣에선 JSESSIONID라는 이름의 쿠키가 요청에 있었는지 확인하고 없다면 새로운 값을 만들어 세션 저장소에 보관한다. 이 때 세션저장소에서는 JSESSIONID의 값마다 고유한 공간을 가지게 되는데 이 공간에 키와 값을 보관할 수 있다. 
<br><br>
이를 이용해 간단한 로그인 체크를 구현할 수 있는데
사용자가 로그인에 필요한 페이지에 접근했을 때 쿠키가 새로 만들어졌는지 확인하고 새로 만들어졌다면 새로 방문한 사용자로 간주하고 로그인 페이지로 리다이렉션 시킨다.
<br><br>
만약 세션은 있지만 세션 컨텍스트에 JSESSIONID가 있지만 세션 컨텍스트에 로그인 정보가 없다면 역시 로그인 페이지로 리다이렉션 시킨다.
<br>
그러나 로그인 여부를 체크해야하는 경로마다 체크 로직을 넣는다면 중복되는 코드가 생산된다. 그렇기 때문에 필터를 사용하여 일관적으로 처리할 수 있다.
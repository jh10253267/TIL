# Logging

## 개요

운영중인 웹 서비스에 문제가 발생할 수 있다. 이 때 발생한 문제를 재현하고 분석해서 해결해야하는데 아무런 정보가 없다면 재현하기 힘들 수 있다. 그렇기 때문에 프로그램 실행중 일어나는 일들에 대한 정보를 관리하는 것이 중요하다.

문제 상황이 아니라도 성능과 관련된 통계나 정보를 기록해두었다가 이룰 유용하게 사용할 수 있다.

로그를 출력하는 방법은 크게 두 가지가 있다. 그냥 간단하게 웹 서비스를 실습하며 로깅을 할 때에는 한 번에 하나의 요청을 처리하기 때문에 System.out.println()메소드로도 충분하다. 그러나 웹의 특성상 println메소드를 사용하는 것은 좋지 않기 때문에 라이브러리를 사용하는 것에 대해 알아보자. 

## 라이브러리

자바 로깅 라이브러리는 일종의 체계가 있다고 할 수 있다.

SLF4J는 Simple Loggin Facade for Java의 약자로 여러 로깅 라이브러리에 대한 추상화 역할을 하는 라이브러리이다.

만약 특정 로깅 라이브러리를 사용하다 보안적 이슈가 발생한다면 이를 빠르게 다른 로깅 라이브러리로 교체해야할 필요가 있다. 이럴 경우 SLF4J라는 인터페이스를 사용하면 단순히 구현체만 교체해주기만 하면 된다. 일종의 OCP라고 할 수 있다.

따라서 SLF4J는 껍데기이기 때문에 단독으로 사용하지 않고 라이브러리를 선택하여 사용한다.

slf4j는 세 가지의 모듈을 제공한다.
1. API  
인터페이스 제공
2. Binding  
인터페이스와 로깅 구현체와 연결하는 어댑터 역할
3. Bridge  


로그 라이브러리에는 여러 종류가 있다. 한번 살펴보자

* `java.util.logging`  
이는 JDK 1.4부터 포함된 표준 로깅 API로 별도의 라이브러리를 추가하지 않고 사용할 수 있다. 그러나 기능이 부족한 이유로 기본 로깅 API말고 다른 라이브러리를 사용하는 것이 일반적이다.
* `Apache Commons logging`  
아파치 재단에서 Commons 라이브러리 중에 로그 출력을 제공하는 라이브러리이다.
* `Log4j`  
아파치 제단에서 제공하는 라이브러리이다.
* `Logback`  
Log4j를 개발한 Ceki Gulcu가 Log4j의 단점 개선 및 기능을 추가하여 개발한 로깅 라이브러리이다.


## 사용방법

레거시한 Spring에서 이러한 로깅 라이브러리를 어떻게 사용하는지 알아보자.

우선 slf4j의존성이 필요하고 그 구현체인 logback을 사용해보자.

logback-classic은 이미 slf4j-api를 포함하고 있기 때문에 해당 의존성을 추가했다면 slf4j-api 의존성을 추가해주지 않아도 괜찮다.

Spring은 기본적으로 아파치 재단의 commons-logging을 사용하고 있기 때문에 logback을 사용하려면 제거해주어야한다.

이렇게 제거하면 Spring은 commons-loggings를 찾기 때문에 이러한 오류를 제거하기 위해서 jcl-over-slf4j의존성을 추가해주어야한다.

이는 commons와 동일한 구조의 라이브러리로 내부적으로 slf4j를 사용해서 로그를 남기게된다.

이렇게 한다음에는 Logback을 사용하기 위한 xml파일을 작성해주어야한다.

* Appender  
어디에 어떤 포멧으로 로그를 남길지를 설정.

consoleAppender : 콘솔에 로그를 어떤 포멧으로 출력할지 설정.
FileAppender : 파일에 로그를 어떤 포맷으로 출력할지 설정.
RollingFileAppender: 로그가 많아지만 하나의 파일로 관리하기 어려워지는 문제가 생긴다. 이를 위해 하루 단위로 로그를 관리하고자 할 경우 사용.


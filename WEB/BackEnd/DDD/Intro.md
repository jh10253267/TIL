# DDD

## 개요

도메인에 대해 처음 들었을 땐 우리가 프로그램을 작성할 때 게시글, 댓글, 좋아요등의 기능들과 패키지를 나누어 관리하는 개념이라고만 생각했다.

지금까지 공부해본 느낌으론 코드 외적인 부분의 뉘앙스가 느껴진다. TDD와 같은 느낌의 이론이 아니라 애자일과 xp와 같은 느낌이 들었다.

> 의뢰인과 개발자 모두가 만족할만한 결과물을 내기위한 방법.

## 도메인이란?

온라인 서점을 이용하는 경우를 생각해보자 어떤 책이 나왔는지 검색하고 목차와 서평을 보면서 이 책은 어떤 책일지 가늠해본다. 읽고싶은 책이 있다면 장바구니에 담아두기도하고
구매할 때도 있다.

이런 서비스를 구현한다고 생각해보자. 가장 큰 단위는 온라인 서점이다.
그리고 온라인 서점 서비스는 책을 판매하는데 필요한 상품 조회, 구매, 결제, 배송 추적 등의 기능을 제공해야한다.
이 때 온라인 서점은 소프트웨어로 해결하고자 하는 문제영역 즉 도메인에 해당한다.

한 도메인은 다시 하위 도메인으로 나눌 수 있다.

카탈로그 하위 도메인은 고객에게 구매할 수 있는 상품 목록을 제공하고 주문 하위 도메인은 고객의 주문을 처리하는 등이다.

우리가 개발하는 기능들의 영역에는 전문가들이 있다. 이들은 해당 도메인에 대한 지식과 경험을 바탕으로 본인들이 원하는 기능 개발을 요구한다.

## 도메인 모델

도메인 모델은 특정 도메인을 개념적으로 표현한 것이다. 

주문 도메인을 예로 들면 어떤 상품을 주문하려면 상품과 상품 갯수를 선택한다. 그리고 배송지를 입력하고 총 지불 금액을 계산하고 결제수단을 선택하는 등.

이를 자바의 객체로 나타내는 식이다.

## 도메인 모델 패턴

일반적인 애플리케이션의 아키텍쳐는 다음과 같이 구성된다.

* UI - 사용자의 요청을 처리하고 사용자에게 정보를 보여준다.
* 응용 - 사용자가 요청한 기능을 실행한다.
* 도메인 - 시스템이 제공할 도메인 규칙을 구현한다.
* 인프라스트럭쳐 - 데이터베이스와 같은 외부 시스템과의 연동을 처리한다.

도메인 계층은 도메인의 핵심규칙을 구현한다. 주문 도메인의 경우 출고 전에 배송지를 변경할 수 있다는 규칙과 주문 취소는 배송 전에만 할 수 있다는 규칙을 구현한 코드가 도메인 계층에 위치하게된다. 이런 도메인 규칙을 객체 지향 기법으로 구현하는 패턴이 도메인 모델 패턴이다.

여기까지는 사실 객체지향 프로그래밍이랑 큰 차이가 없어보인다.

도메인의 규칙을 정의하고 구현한다.


## 엔티티와 벨류

도출된 모델은 엔티티와 벨류로 구분할 수 있는데 엔티티란 식별자를 갖는 클래스를 말하고 벨류는 개념적으로 완전한 하나를 표현할 때 사용한다.

여기까지는 그저 엔티티와 DTO의 개념처럼 보인다.


## 아키텍쳐

전형적인 웹 구조를 네가지 계층으로 나눌 수 있다.

* 표현계층
* 응용계층
* 도메인 계층
* 인프라스트럭쳐 계층

표현 영역은 사용자의 요청을 받아 응용영역에 전달하고 처리 결과를 다시 사용자에게 보여주는 역할을 한다. 스프링 MVC프레임워크가 표현 영역을 위한 기술에 해당한다.

응용 영역은 시스템이 사용자에게 제공해야할 기능을 구현한다. 응용영역은 기능을 구현하기 위해 도메인 영역의 도메인 모델을 사용한다.

따라서 로직을 직접 수행하기 보다는 도메인 모델에 로직 수행을 위임한다.

## DIP

일반적으로 고수준 모듈은 저수준 모델에 의존한다.

예를 들어 JPA를 사용한다던지 하는 부분이다.

그러나 이런 구조에는 단점이 있는데 바로 구현 변경과 테스트가 어렵다는 문제가 발생하게 된다.

구현 변경이 어렵다는 말은 하위 모듈(일을 위임받은)의 클래스명이 바뀌면 상위 모듈의 코드도 함께 변경해야한다.

하위 모듈에 의존하기 때문에 하위 모듈이 완벽하게 동작해야만 상위 모듈을 테스트할 수 있다.

이러한 단점의 해결책이 될 수 있는 것이 바로 DIP이다.

DIP는 상위 모듈이 하위 모듈에 의존하는 것이 아닌 하위 모듈이 상위 모듈에 의존하도록 하는 것이다.

이를 위해 추상화된 인터페이스를 이용한다. 하위 모듈을 인터페이스로 구현하여 상위 모듈은 인터페이스(경계면)을 바라보고 하위 모듈의 코드를 이해할 필요가 없다.

여기까 봐도 DDD가 특별하게 다가오지 않는다.

## 애그리거트

도메인이 커질수록 개발할 도메인 모델이 커지면서 많은 엔티티와 벨류가 생긴다. 이렇게 복잡해진 모델을 다시 그룹화 하여 묶은 것이 바로 애그리거트이다.








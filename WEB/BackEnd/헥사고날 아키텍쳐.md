# 헥사고날 아키텍쳐

## 개요

백엔드 아키텍쳐는 여러가지가 있다고 한다. 3계층, 양파, 헥사고날 등등

MSA를 공부하며 자주 등장하는 아키텍쳐인 헥사고날 아키텍쳐에 대해 알아보자
 
## 개념

이전에 레이어드 아키텍쳐에 대해 정리한 적이 있다. DIP를 사용하여 각 계층 간에 느슨한 관계를 유지하고 상위 모듈이 하위 모듈에 의존하는 것을 줄였다.  

그러나 레이어드 아키텍처에 DIP를 적용해도 한계가 있다. 프레젠테이션 계층과 데이터 엑세스 계층은 저수준 계층으로 현대 애플리케이션에서는 이러한 두 가지의 계층 말고도 다양한 인터페이스를 필요로한다.

애플리케이션을 호출하는 다양한 시스템의 유형과 애플리케이션과 상호작용하는 다양한 저장소가 존재한다. 이들을 단방향 계층구조에서 지원하는 것은 힘들다.

따라서 다른 아키텍쳐를 고안해볼 필요가 있다.

헥사고날 아키텍쳐는 엘리스테어 콕반이 제시한 아키텍쳐로 포트 앤드 어댑터 아키텍처라고도 하고 그 이름 그대로 육각형의 구조를 말한다. 

<img width="412" alt="스크린샷 2024-06-05 오후 2 49 53" src="https://github.com/jh10253267/TIL/assets/108499717/713e5975-2ff3-4c9b-8842-5751a799d364">

주된 특징으로는 고수준의 비즈니스 로직을 표현하는 내부 영역과 인터페이스 처리를 담당하는 저수준 외부 영역으로 나눈다. 내부 영역은 순수한 비즈니스 로직을 표현하며 기술 독립적인 영역이라고한다.

그리고 외부 영역과 연계되는 포트를 가지고 있어서 외부에서 들어오는 요청을 처리하는 인바운드 어댑터와 비즈니스 로직에 의해 호출되어 외부와 연계되는 아웃바운드 어댑터로 구성된다.  

이렇게 구성하게 되면 고수준의 내부 영역이 외부 구체 어댑터에 의존하지 않게할 수 있다.

아웃바운드 포트는 내부 영역이 외부를 호출하는 방법을 정의하고 인바운드 포트는 내부 영역의 사용을 위해 노출된 API이다. 이를 외부 영역의 인바운드 어댑터가 호출한다.

인바운드 어댑터로는 REST API를 발행하는 컨트롤러와 웹페이지를 구성하는 MVC컨트롤러등이 있고 아웃바운드 어댑터로는 데이터 엑세스 처리를 담당하는 DAO등이 있다.

## 클린 아키텍처

클린 아키텍처는 로버트.C.마틴이 제안한 아키텍처로 헥사고날 아키텍처와 유사하다.

마틴은 소프트웨어는 행위 가치와 구조 가치의 가치를 가지며 구조 가치가 더 중요하다고 말한다.

이는 구조 중에서 선택할 수 있는 것을 가능한 한 오랫동안 열어두는 것을 의미한다.

중앙에서부터 밖으로 엔티티, 유스케이스, 그 외의 세부사항으로 구분한다.

엔티티에는 업무규칙을 정의한다. 업무 규칙은 사업적으로 수익을 얻거나 비용을 줄일 수 있는 규칙또는 절차를 말한다.

은행을 예로 들면, 이자 계산 규칙, 대출 심사 규칙 등등이 있을 것이고 보통 데이터를 요구한다. 그리고 이들은 본질적으로 결합되어있기 때문에 객체로 다루고 엔티티라고 칭한다.

그 다음 계층은 유스케이스 계층이다. 이는 자동화된 시스템을 처리하는 처리 절차를 기술하고 애플리케이션에 특화된 업무 규칙을 표현하며 엔티티 내부의 핵심 업무 규칙을 호출하며 시스템을 사용하는 흐름을 담는다. 여기서 엔티티는 고수준 영역에 해당하므로 저수준의 유스케이스 영역을 알게하면 안된다. 또한, 엔티티는 간단한 객체여야하고 프레임워크, 데이터베이스등 복잡한 것에 의존해선 안되고 유스케이스 객체를 통해서만 조작해야한다.

그 다음은 세부사항으로 입출력, 저장소, 서버, 프레임워크등에 해당하고 이전 계층은 유스케이스와의 관계를 DIP를 이용해서 유연하게 처리해야한다.

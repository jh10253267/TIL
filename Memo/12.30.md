# 웹 사이트 분석

## 개요

토큰으로 로그인을 구현하다가 궁금한점이 생겼다. 시큐리티의 세션 방식을 사용하지 않고 jwt토큰을 이용하는 이유가 뭘까

내 생각으론 jwt는 rest api에서 쓰이는 인증 방식이라고 생각한다. rest api 경로에 아무런 보안적인 필터가 없다면 누구나 api를 호출하여 작업할 수 있기 때문이다.
rest제약조건중 2번 stateless에 따라 api서버는 사용자의 상태를 기억하지 않아야한다.

그래서 jwt토큰 방식을 사용하는 것이라 생각한다.

그러나 mvc 서버는 다르다. 사용자의 상태를 기억해야하고 인증을 거치지 않았다면 작업이 불가능하다.

이런 생각이 들어서 여러 웹사이트를 분석해봤다.

## 부스트코스

네이버 소셜 로그인을 통해 로그인했고 쿠키에  `NEO-SES`와 `NEO-CHK`가 생겼다. `NEO-CHK`를 삭제한다고 해도 로그인이 풀리지 않는다. 그러나 NEO-SES를 삭제하면 로그인이 풀린다.

그리고 다시 로그인을 시도하면 네이버 로그인을 할 필요없이 자동으로 로그인이 된다 -> 네이버 로그인 정보가 남아있다.

네이버 계정을 통해 로그인했을 경우`NID`로 시작하는 쿠키들이 생겼고 이 쿠키들을 삭제하면 부스트코스 로그인도 풀리고 네이버 로그인도 풀렸다.

## 스파르타

쿠키를 살펴보니 `token과` `refresh`이라는 쿠키가 보인다.

token이라는 쿠키의 유효기간은 1일이고 refresh쿠키는 2주가 유효기간이다. 이게 api 서버에서 사용하는 jwt토큰으로 보인다. 타입이라는 값도 access와 refresh로 나누어져있다.

token과 refresh 토큰을 제외하고 삭제해보니 로그인이 풀리진 않았는데 내 정보를 읽어오지 못한다. 로그인을 하라고 나오진 않지만 내 정보를 읽어오지 못하니 사실상 로그아웃이 된거나 다름없다.

token이 있다고해서 로그인이 된 상태인 것처럼 작업을 할 순 없다.

token을 삭제해봤더니 로그인이 풀렸다.

다시 로그인하고 userinfo라는 쿠키를 삭제하니 내 정보를 읽어오지 못한다.


## 프로그래머스

`_programmers_session_production` 라는 쿠키가 있고 로그인 한 뒤 삭제해보면 로그인이 풀린다.

쿠키의 유효 기간은 접속일로부터 1년이다.

쿠키-세션 방식의 로그인으로 보임

## 네이버

로그아웃을 클릭하면 nid_inf, NID_AUT, NID_SES, NID_JKL, NNPD 쿠키를 서버에서 만료시킨다.

쿠키-세션 방식의 로그인으로 보임

내 메일 api를 호출할 때 로그인한 유저의 Ip와 호출하는 곳의 ip를 비교해서 동일하다면 호출이 가능한 듯 보인다.


## 결론

웹 서비스들마다 로그인 방식이 다른데 쿠키-세션을 이용한 로그인 방식이 더 많았다. 쿠키-세션을 이용할 경우 api를 외부에서 마음대로 호출하는 문제는 ip를 비교해서 해결하는 듯 보인다.

너무 rest스타일에 집착할 필요는 없는 것 같다. 애초에 대부분의 api들은 restful하지 않기 때문이다.


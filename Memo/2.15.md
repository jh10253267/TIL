# 2.15

성능 개선으로 쿼리 실행 속도를 개선해보려 했다.

우선 가장 기본적으로 할 수 있는 것이 검색조건으로 활용되는 속성에 인덱스를 걸어서 조회를 빠르게 하는 것이였다.

인덱스를 걸고 테스트 해본 결과 성능 개선이 보였다.

그러나 처음 요청했을 경우와 같은 요청을 여러번 보냈을 경우 조회 시간이 점점 단축되는 것을 발견했다.

테스트 조건은 동일했는데 말이다.

DB내부에서 무언가 작업이 일어나는 것 같았다.

예를 들어 쿼리를 날렸을 때 인덱스를 타는지 안타는지도 DB 내부에서 결정하는 부분이라고 한다.

그래서 EXPLAIN 문법을 사용하여 분석해야한다.

전에 SQL Injection을 공부할 때 쿼리의 실행 순서에 대해 정리했었다.

1. Parsing - 쿼리문이 문법적오류를 가지는 지 체크
2. Semantics Check - DB는 쿼리의 유효성을 체크한다. 쿼리문에 명시된 테이블이 정말 존재하는지 컬럼은 존재하는지 쿼리를 실행한 유저가 해당 작업을 수행할 자격이 있는지.
3. Binding - 쿼리가 기계친화적 언어로 바뀌는 단계
4. Query Optimization - 쿼리문을 실행하는데 가장 최적의 알고리즘을 찾는 단계. 쿼리가 컴파일되고 db서버에 전송된다.
5. Cache - 가장 최적의 알고리즘이 캐시에 저장된다. 같은 쿼리가 다시 들어올 경우 앞의 단계들을 건너뛰고 바로 실행된다.
6. Execution - 쿼리가 실행되고 결과가 반환된다.

이렇게 보자면 DB내부에서 캐시를 사용하기 때문에 정확한 측정이 어려울 것 같다는 생각이 들었다.

내일은 DB 내부의 작동 원리와 쿼리 옵티마이저에 대해 공부해봐야겠다.